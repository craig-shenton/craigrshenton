<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Craig Shenton">
<meta name="dcterms.date" content="2021-09-09">
<meta name="description" content="Open access and reusable design documentation of pipelines used in the NHSX Analytics Azure Data Factory (ADF) environment.">

<title>craigrshenton - Azure Data Factory Templates</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../assets/favicons/Rubics_Cube.svg" rel="icon" type="image/svg+xml">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>


<meta property="og:title" content="craigrshenton - Azure Data Factory Templates">
<meta property="og:description" content="Open access and reusable design documentation of pipelines used in the NHSX Analytics Azure Data Factory (ADF) environment.">
<meta property="og:site-name" content="craigrshenton">
<meta name="twitter:title" content="craigrshenton - Azure Data Factory Templates">
<meta name="twitter:description" content="Open access and reusable design documentation of pipelines used in the NHSX Analytics Azure Data Factory (ADF) environment.">
<meta name="twitter:card" content="summary">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"><i class="bi bi-rss" role="img" aria-label="home">
</i> 
 <span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html"><i class="bi bi-info-circle" role="img">
</i> 
 <span class="menu-text">About</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/craig-shenton"><i class="bi bi-github" role="img" aria-label="github">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/craigrshenton/"><i class="bi bi-linkedin" role="img" aria-label="linkedin">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#sql-database-ingestion-pipeline" id="toc-sql-database-ingestion-pipeline" class="nav-link" data-scroll-target="#sql-database-ingestion-pipeline">SQL Database Ingestion Pipeline</a>
  <ul class="collapse">
  <li><a href="#metadata" id="toc-metadata" class="nav-link" data-scroll-target="#metadata">Metadata</a></li>
  <li><a href="#description" id="toc-description" class="nav-link" data-scroll-target="#description">Description</a></li>
  <li><a href="#pipeline-configuration" id="toc-pipeline-configuration" class="nav-link" data-scroll-target="#pipeline-configuration">Pipeline Configuration</a></li>
  <li><a href="#data-factory-configuration" id="toc-data-factory-configuration" class="nav-link" data-scroll-target="#data-factory-configuration">Data Factory Configuration</a></li>
  </ul></li>
  <li><a href="#databricks-ingestion-pipeline" id="toc-databricks-ingestion-pipeline" class="nav-link" data-scroll-target="#databricks-ingestion-pipeline">Databricks Ingestion Pipeline</a>
  <ul class="collapse">
  <li><a href="#metadata-1" id="toc-metadata-1" class="nav-link" data-scroll-target="#metadata-1">Metadata</a></li>
  <li><a href="#description-1" id="toc-description-1" class="nav-link" data-scroll-target="#description-1">Description</a></li>
  <li><a href="#pipeline-configuration-1" id="toc-pipeline-configuration-1" class="nav-link" data-scroll-target="#pipeline-configuration-1">Pipeline Configuration</a></li>
  <li><a href="#data-factory-configuration-1" id="toc-data-factory-configuration-1" class="nav-link" data-scroll-target="#data-factory-configuration-1">Data Factory Configuration</a></li>
  </ul></li>
  <li><a href="#excel-sheet-ingestion-pipeline" id="toc-excel-sheet-ingestion-pipeline" class="nav-link" data-scroll-target="#excel-sheet-ingestion-pipeline">Excel Sheet Ingestion Pipeline</a>
  <ul class="collapse">
  <li><a href="#metadata-2" id="toc-metadata-2" class="nav-link" data-scroll-target="#metadata-2">Metadata</a></li>
  <li><a href="#description-2" id="toc-description-2" class="nav-link" data-scroll-target="#description-2">Description</a></li>
  <li><a href="#pipeline-configuration-2" id="toc-pipeline-configuration-2" class="nav-link" data-scroll-target="#pipeline-configuration-2">Pipeline Configuration</a></li>
  <li><a href="#data-factory-configuration-2" id="toc-data-factory-configuration-2" class="nav-link" data-scroll-target="#data-factory-configuration-2">Data Factory Configuration</a></li>
  </ul></li>
  <li><a href="#multiple-excel-sheet-ingestion-pipeline" id="toc-multiple-excel-sheet-ingestion-pipeline" class="nav-link" data-scroll-target="#multiple-excel-sheet-ingestion-pipeline">Multiple Excel Sheet Ingestion Pipeline</a>
  <ul class="collapse">
  <li><a href="#metadata-3" id="toc-metadata-3" class="nav-link" data-scroll-target="#metadata-3">Metadata</a></li>
  <li><a href="#description-3" id="toc-description-3" class="nav-link" data-scroll-target="#description-3">Description</a></li>
  <li><a href="#pipeline-configuration-3" id="toc-pipeline-configuration-3" class="nav-link" data-scroll-target="#pipeline-configuration-3">Pipeline Configuration</a></li>
  <li><a href="#data-factory-configuration-3" id="toc-data-factory-configuration-3" class="nav-link" data-scroll-target="#data-factory-configuration-3">Data Factory Configuration</a></li>
  </ul></li>
  <li><a href="#web-url-data-ingestion-pipeline" id="toc-web-url-data-ingestion-pipeline" class="nav-link" data-scroll-target="#web-url-data-ingestion-pipeline">Web URL Data Ingestion Pipeline</a>
  <ul class="collapse">
  <li><a href="#metadata-4" id="toc-metadata-4" class="nav-link" data-scroll-target="#metadata-4">Metadata</a></li>
  <li><a href="#description-4" id="toc-description-4" class="nav-link" data-scroll-target="#description-4">Description</a></li>
  <li><a href="#pipeline-configuration-4" id="toc-pipeline-configuration-4" class="nav-link" data-scroll-target="#pipeline-configuration-4">Pipeline Configuration</a></li>
  <li><a href="#data-factory-configuration-4" id="toc-data-factory-configuration-4" class="nav-link" data-scroll-target="#data-factory-configuration-4">Data Factory Configuration</a></li>
  </ul></li>
  <li><a href="#azure-function-app-ingestion-pipeline" id="toc-azure-function-app-ingestion-pipeline" class="nav-link" data-scroll-target="#azure-function-app-ingestion-pipeline">Azure Function App Ingestion Pipeline</a>
  <ul class="collapse">
  <li><a href="#metadata-5" id="toc-metadata-5" class="nav-link" data-scroll-target="#metadata-5">Metadata</a></li>
  <li><a href="#description-5" id="toc-description-5" class="nav-link" data-scroll-target="#description-5">Description</a></li>
  <li><a href="#pipeline-configuration-5" id="toc-pipeline-configuration-5" class="nav-link" data-scroll-target="#pipeline-configuration-5">Pipeline Configuration</a></li>
  <li><a href="#data-factory-configuration-5" id="toc-data-factory-configuration-5" class="nav-link" data-scroll-target="#data-factory-configuration-5">Data Factory Configuration</a></li>
  </ul></li>
  <li><a href="#sharepoint-ingestion-pipeline" id="toc-sharepoint-ingestion-pipeline" class="nav-link" data-scroll-target="#sharepoint-ingestion-pipeline">SharePoint Ingestion Pipeline</a>
  <ul class="collapse">
  <li><a href="#metadata-6" id="toc-metadata-6" class="nav-link" data-scroll-target="#metadata-6">Metadata</a></li>
  <li><a href="#description-6" id="toc-description-6" class="nav-link" data-scroll-target="#description-6">Description</a></li>
  <li><a href="#pipeline-configuration-6" id="toc-pipeline-configuration-6" class="nav-link" data-scroll-target="#pipeline-configuration-6">Pipeline Configuration</a></li>
  <li><a href="#data-factory-configuration-6" id="toc-data-factory-configuration-6" class="nav-link" data-scroll-target="#data-factory-configuration-6">Data Factory Configuration</a></li>
  </ul></li>
  <li><a href="#databricks-processing-pipeline" id="toc-databricks-processing-pipeline" class="nav-link" data-scroll-target="#databricks-processing-pipeline">Databricks Processing Pipeline</a>
  <ul class="collapse">
  <li><a href="#metadata-7" id="toc-metadata-7" class="nav-link" data-scroll-target="#metadata-7">Metadata</a></li>
  <li><a href="#description-7" id="toc-description-7" class="nav-link" data-scroll-target="#description-7">Description</a></li>
  <li><a href="#pipeline-configuration-7" id="toc-pipeline-configuration-7" class="nav-link" data-scroll-target="#pipeline-configuration-7">Pipeline Configuration</a></li>
  <li><a href="#databricks-orchestration" id="toc-databricks-orchestration" class="nav-link" data-scroll-target="#databricks-orchestration">Databricks Orchestration</a></li>
  <li><a href="#data-factory-configuration-7" id="toc-data-factory-configuration-7" class="nav-link" data-scroll-target="#data-factory-configuration-7">Data Factory Configuration</a></li>
  </ul></li>
  <li><a href="#azure-function-app-processing-pipeline" id="toc-azure-function-app-processing-pipeline" class="nav-link" data-scroll-target="#azure-function-app-processing-pipeline">Azure Function App Processing Pipeline</a>
  <ul class="collapse">
  <li><a href="#metadata-8" id="toc-metadata-8" class="nav-link" data-scroll-target="#metadata-8">Metadata</a></li>
  <li><a href="#description-8" id="toc-description-8" class="nav-link" data-scroll-target="#description-8">Description</a></li>
  <li><a href="#pipeline-configuration-8" id="toc-pipeline-configuration-8" class="nav-link" data-scroll-target="#pipeline-configuration-8">Pipeline Configuration</a></li>
  <li><a href="#data-factory-configuration-8" id="toc-data-factory-configuration-8" class="nav-link" data-scroll-target="#data-factory-configuration-8">Data Factory Configuration</a></li>
  </ul></li>
  <li><a href="#multiple-azure-function-apps-processing-pipeline" id="toc-multiple-azure-function-apps-processing-pipeline" class="nav-link" data-scroll-target="#multiple-azure-function-apps-processing-pipeline">Multiple Azure Function Apps Processing Pipeline</a>
  <ul class="collapse">
  <li><a href="#metadata-9" id="toc-metadata-9" class="nav-link" data-scroll-target="#metadata-9">Metadata</a></li>
  <li><a href="#description-9" id="toc-description-9" class="nav-link" data-scroll-target="#description-9">Description</a></li>
  <li><a href="#pipeline-configuration-9" id="toc-pipeline-configuration-9" class="nav-link" data-scroll-target="#pipeline-configuration-9">Pipeline Configuration</a></li>
  <li><a href="#data-factory-configuration-9" id="toc-data-factory-configuration-9" class="nav-link" data-scroll-target="#data-factory-configuration-9">Data Factory Configuration</a></li>
  </ul></li>
  <li><a href="#copy-file-processing-pipeline" id="toc-copy-file-processing-pipeline" class="nav-link" data-scroll-target="#copy-file-processing-pipeline">Copy File Processing Pipeline</a>
  <ul class="collapse">
  <li><a href="#metadata-10" id="toc-metadata-10" class="nav-link" data-scroll-target="#metadata-10">Metadata</a></li>
  <li><a href="#description-10" id="toc-description-10" class="nav-link" data-scroll-target="#description-10">Description</a></li>
  <li><a href="#pipeline-configuration-10" id="toc-pipeline-configuration-10" class="nav-link" data-scroll-target="#pipeline-configuration-10">Pipeline Configuration</a></li>
  <li><a href="#data-factory-configuration-10" id="toc-data-factory-configuration-10" class="nav-link" data-scroll-target="#data-factory-configuration-10">Data Factory Configuration</a></li>
  </ul></li>
  <li><a href="#sql-table-staging-pipeline" id="toc-sql-table-staging-pipeline" class="nav-link" data-scroll-target="#sql-table-staging-pipeline">SQL Table Staging Pipeline</a>
  <ul class="collapse">
  <li><a href="#metadata-11" id="toc-metadata-11" class="nav-link" data-scroll-target="#metadata-11">Metadata</a></li>
  <li><a href="#description-11" id="toc-description-11" class="nav-link" data-scroll-target="#description-11">Description</a></li>
  <li><a href="#pipeline-configuration-11" id="toc-pipeline-configuration-11" class="nav-link" data-scroll-target="#pipeline-configuration-11">Pipeline Configuration</a></li>
  <li><a href="#data-factory-configuration-11" id="toc-data-factory-configuration-11" class="nav-link" data-scroll-target="#data-factory-configuration-11">Data Factory Configuration</a></li>
  </ul></li>
  <li><a href="#multiple-sql-table-staging-pipeline" id="toc-multiple-sql-table-staging-pipeline" class="nav-link" data-scroll-target="#multiple-sql-table-staging-pipeline">Multiple SQL Table Staging Pipeline</a>
  <ul class="collapse">
  <li><a href="#metadata-12" id="toc-metadata-12" class="nav-link" data-scroll-target="#metadata-12">Metadata</a></li>
  <li><a href="#description-12" id="toc-description-12" class="nav-link" data-scroll-target="#description-12">Description</a></li>
  <li><a href="#pipeline-configuration-12" id="toc-pipeline-configuration-12" class="nav-link" data-scroll-target="#pipeline-configuration-12">Pipeline Configuration</a></li>
  <li><a href="#data-factory-configuration-12" id="toc-data-factory-configuration-12" class="nav-link" data-scroll-target="#data-factory-configuration-12">Data Factory Configuration</a></li>
  </ul></li>
  </ul>
</nav>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Azure Data Factory Templates</h1>
  <div class="quarto-categories">
    <div class="quarto-category">Azure</div>
    <div class="quarto-category">Data Factory</div>
  </div>
  </div>

<div>
  <div class="description">
    Open access and reusable design documentation of pipelines used in the NHSX Analytics Azure Data Factory (ADF) environment.
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Craig Shenton </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 9, 2021</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="introduction" class="level3">
<h3 class="anchored" data-anchor-id="introduction">Introduction</h3>
<p>Open access and reusable design documentation of pipelines used in the NHSX Analytics Azure Data Factory (ADF) environment.</p>
<ul>
<li><a href="#sql-database-ingestion-pipeline">SQL Database Ingestion Pipeline</a></li>
<li><a href="#databricks-ingestion-pipeline">Databricks Ingestion Pipeline</a></li>
<li><a href="#excel-sheet-ingestion-pipeline">Excel Sheet Ingestion Pipeline</a></li>
<li><a href="#multiple-excel-sheet-ingestion-pipeline">Multiple Excel Sheet Ingestion Pipeline</a></li>
<li><a href="#web-url-data-ingestion-pipeline">Web URL Data Ingestion Pipeline</a></li>
<li><a href="#azure-function-app-ingestion-pipeline">Azure Function App Ingestion Pipeline</a></li>
<li><a href="#sharepoint-ingestion-pipeline">SharePoint Ingestion Pipeline</a></li>
<li><a href="#databricks-processing-pipeline">Databricks Processing Pipeline</a></li>
<li><a href="#azure-function-app-processing-pipeline">Azure Function App Processing Pipeline</a></li>
<li><a href="#multiple-azure-function-apps-processing-pipeline">Multiple Azure Function Apps Processing Pipeline</a></li>
<li><a href="#copy-file-processing-pipeline">Copy File Processing Pipeline</a></li>
<li><a href="#sql-table-staging-pipeline">SQL Table Staging Pipeline</a></li>
<li><a href="#multiple-sql-table-staging-pipeline">Multiple SQL Table Staging Pipeline</a></li>
</ul>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Originally posted on the <a href="https://nhsx.github.io/AnalyticsUnit/azure-de-principles.html">NHSX technical gateway</a> website.</p>
</div>
</div>
</section>
<section id="sql-database-ingestion-pipeline" class="level2">
<h2 class="anchored" data-anchor-id="sql-database-ingestion-pipeline">SQL Database Ingestion Pipeline</h2>
<section id="metadata" class="level3">
<h3 class="anchored" data-anchor-id="metadata">Metadata</h3>
<ul>
<li>FILE: ingestion_sql.json</li>
<li>DESCRIPTION: Pipeline to ingest raw data to Azure Datalake blob storage from a SQL database.</li>
<li>CONTRIBUTORS: Craig Shenton, Mattia Ficarelli</li>
<li>CONTACT: data@nhsx.nhs.uk</li>
<li>CREATED: 20 Sept 2021</li>
<li>VERSION: 0.0.1</li>
</ul>
</section>
<section id="description" class="level3">
<h3 class="anchored" data-anchor-id="description">Description</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../assets/images/pipeline_temps/sql-ingest.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Data ingestion from a SQL database</figcaption><p></p>
</figure>
</div>
<p><em>Figure 1: Data ingestion from a SQL database</em></p>
<p>Pipeline to ingest raw data to Azure Datalake blob storage from a SQL database.</p>
<ol type="1">
<li>Looks up the <code>.json</code> configuration file for this pipeline</li>
<li>Source:
<ol type="a">
<li>Sets the source database owner (dbo)</li>
<li>Sets the source table</li>
<li>Sets the SQL query</li>
</ol></li>
<li>Sink:
<ol type="a">
<li>Sets the file system</li>
<li>Sets the sink path</li>
<li>Sets the sink file</li>
</ol></li>
<li>Copy activity copies the data returned from the SQL query as either a <code>.csv</code> file or a <code>.parquet</code> file.</li>
<li>If the copy activity fails, the error notification logic app API will notify the specified email address of the error</li>
</ol>
</section>
<section id="pipeline-configuration" class="level3">
<h3 class="anchored" data-anchor-id="pipeline-configuration">Pipeline Configuration</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">{</span></span>
<span id="cb1-2"><a href="#cb1-2"></a>  <span class="dt">"pipeline"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb1-3"><a href="#cb1-3"></a>    <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"ingestion_sql"</span><span class="fu">,</span></span>
<span id="cb1-4"><a href="#cb1-4"></a>    <span class="dt">"folder"</span><span class="fu">:</span> <span class="st">"templates/ingestion/sql"</span><span class="fu">,</span></span>
<span id="cb1-5"><a href="#cb1-5"></a>    <span class="dt">"adl_file_system"</span><span class="fu">:</span> <span class="st">"file_system"</span><span class="fu">,</span></span>
<span id="cb1-6"><a href="#cb1-6"></a>    <span class="dt">"raw"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb1-7"><a href="#cb1-7"></a>      <span class="dt">"source_dbo"</span><span class="fu">:</span> <span class="st">"dbo"</span><span class="fu">,</span></span>
<span id="cb1-8"><a href="#cb1-8"></a>      <span class="dt">"source_table"</span><span class="fu">:</span> <span class="st">"table_1"</span><span class="fu">,</span></span>
<span id="cb1-9"><a href="#cb1-9"></a>      <span class="dt">"source_query"</span><span class="fu">:</span> <span class="st">"SELECT * FROM dbo.table_1 ORDER BY Date DESC"</span><span class="fu">,</span></span>
<span id="cb1-10"><a href="#cb1-10"></a>      <span class="dt">"sink_path"</span><span class="fu">:</span> <span class="st">"raw/path/to/data"</span><span class="fu">,</span></span>
<span id="cb1-11"><a href="#cb1-11"></a>      <span class="dt">"sink_file"</span><span class="fu">:</span> <span class="st">"table_1.parquet"</span></span>
<span id="cb1-12"><a href="#cb1-12"></a>    <span class="fu">}</span></span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="data-factory-configuration" class="level3">
<h3 class="anchored" data-anchor-id="data-factory-configuration">Data Factory Configuration</h3>
<p>Download the Azure Data Factory json configuration file to use this template in your own data pipelines.</p>
<p><a href="https://raw.githubusercontent.com/nhsx/au-data-engineering/main/config-files/adf-templates/sql-ingestion.json">sql-ingestion.json</a></p>
</section>
</section>
<section id="databricks-ingestion-pipeline" class="level2">
<h2 class="anchored" data-anchor-id="databricks-ingestion-pipeline">Databricks Ingestion Pipeline</h2>
<section id="metadata-1" class="level3">
<h3 class="anchored" data-anchor-id="metadata-1">Metadata</h3>
<ul>
<li>FILE: ingestion_databricks.json</li>
<li>DESCRIPTION: Pipeline to ingest raw data to Azure Datalake blob storage using a databricks notebook.</li>
<li>CONTRIBUTORS: Craig Shenton, Mattia Ficarelli</li>
<li>CONTACT: data@nhsx.nhs.uk</li>
<li>CREATED: 20 Sept 2021</li>
<li>VERSION: 0.0.1</li>
</ul>
</section>
<section id="description-1" class="level3">
<h3 class="anchored" data-anchor-id="description-1">Description</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../assets/images/pipeline_temps/databricks/databricks.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Data ingestion using a databricks notebook</figcaption><p></p>
</figure>
</div>
<p><em>Figure 2: Data ingestion using a databricks notebook</em></p>
<p>Pipeline to ingest raw data to Azure Datalake blob storage using a databricks notebook.</p>
<ol type="1">
<li>Lookup the <code>.json</code> configuration file for this pipeline.</li>
<li>Set the databricks notebook path.</li>
<li>Databricks notebook activity runs the databricks notebook specified using an ephemeral job cluster.</li>
<li>If the databricks notebook activity fails, the error notification logic app API will notify the specified email address of the error.</li>
</ol>
<p>Within the databricks notebook, using Azure Databricks Functions, data can be saved to blob storage as either a <code>.csv</code> file or a <code>.parquet</code> file.</p>
</section>
<section id="pipeline-configuration-1" class="level3">
<h3 class="anchored" data-anchor-id="pipeline-configuration-1">Pipeline Configuration</h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb2-1"><a href="#cb2-1"></a><span class="fu">{</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>  <span class="dt">"pipeline"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb2-3"><a href="#cb2-3"></a>    <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"ingestion_databricks"</span><span class="fu">,</span></span>
<span id="cb2-4"><a href="#cb2-4"></a>    <span class="dt">"folder"</span><span class="fu">:</span> <span class="st">"templates/ingestion/databricks"</span><span class="fu">,</span></span>
<span id="cb2-5"><a href="#cb2-5"></a>    <span class="dt">"adl_file_system"</span><span class="fu">:</span> <span class="st">"file_system"</span><span class="fu">,</span></span>
<span id="cb2-6"><a href="#cb2-6"></a>    <span class="dt">"raw"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb2-7"><a href="#cb2-7"></a>      <span class="dt">"databricks_notebook"</span><span class="fu">:</span> <span class="st">"/path/to/databricks/notebook"</span></span>
<span id="cb2-8"><a href="#cb2-8"></a>    <span class="fu">}</span></span>
<span id="cb2-9"><a href="#cb2-9"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="data-factory-configuration-1" class="level3">
<h3 class="anchored" data-anchor-id="data-factory-configuration-1">Data Factory Configuration</h3>
<p>Download the Azure Data Factory <code>.json</code> configuration file to use this template in your own data pipelines.</p>
<p><a href="https://raw.githubusercontent.com/nhsx/au-data-engineering/main/config-files/adf-templates/databricks-ingestion.json">databricks-ingestion.json</a></p>
</section>
</section>
<section id="excel-sheet-ingestion-pipeline" class="level2">
<h2 class="anchored" data-anchor-id="excel-sheet-ingestion-pipeline">Excel Sheet Ingestion Pipeline</h2>
<section id="metadata-2" class="level3">
<h3 class="anchored" data-anchor-id="metadata-2">Metadata</h3>
<ul>
<li>FILE: ingestion_excel_sheet.json</li>
<li>DESCRIPTION: Pipeline to ingest a specified excel file sheet, as a .csv file, to Azure Datalake blob storage.</li>
<li>CONTRIBUTORS: Craig Shenton, Mattia Ficarelli</li>
<li>CONTACT: data@nhsx.nhs.uk</li>
<li>CREATED: 20 Sept 2021</li>
<li>VERSION: 0.0.1</li>
</ul>
</section>
<section id="description-2" class="level3">
<h3 class="anchored" data-anchor-id="description-2">Description</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../assets/images/pipeline_temps/excel_sheet_ingestion.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Data ingestion of an excel file sheet</figcaption><p></p>
</figure>
</div>
<p><em>Figure 3: Data ingestion of an excel file sheet</em></p>
<p>Pipeline to ingest a specified excel file sheet, as a <code>.csv</code> file, to Azure Datalake blob storage.</p>
<ol type="1">
<li>Lookup the <code>.json</code> configuration file for this pipeline.</li>
<li>Set the Azure Datalake file system.</li>
<li>Set the source file path, file name, and excel sheet name.</li>
<li>Set the sink file path and file name.</li>
<li>Copy activity ingests the excel sheet data to a <code>.csv</code> file.</li>
<li>If the copy activity fails, the error notification logic app API will notify the specified email address of the error.</li>
</ol>
</section>
<section id="pipeline-configuration-2" class="level3">
<h3 class="anchored" data-anchor-id="pipeline-configuration-2">Pipeline Configuration</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb3-1"><a href="#cb3-1"></a><span class="fu">{</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>  <span class="dt">"pipeline"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb3-3"><a href="#cb3-3"></a>    <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"ingestion_excel_sheet"</span><span class="fu">,</span></span>
<span id="cb3-4"><a href="#cb3-4"></a>    <span class="dt">"folder"</span><span class="fu">:</span> <span class="st">"templates/ingestion/excel_sheet"</span><span class="fu">,</span></span>
<span id="cb3-5"><a href="#cb3-5"></a>    <span class="dt">"adl_file_system"</span><span class="fu">:</span> <span class="st">"file_system"</span><span class="fu">,</span></span>
<span id="cb3-6"><a href="#cb3-6"></a>    <span class="dt">"raw"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb3-7"><a href="#cb3-7"></a>      <span class="dt">"source_path"</span><span class="fu">:</span> <span class="st">"raw/"</span><span class="fu">,</span></span>
<span id="cb3-8"><a href="#cb3-8"></a>      <span class="dt">"source_file"</span><span class="fu">:</span> <span class="st">"file.xlsx"</span><span class="fu">,</span></span>
<span id="cb3-9"><a href="#cb3-9"></a>      <span class="dt">"source_sheet"</span><span class="fu">:</span> <span class="st">"table_1"</span><span class="fu">,</span></span>
<span id="cb3-10"><a href="#cb3-10"></a>      <span class="dt">"sink_path"</span><span class="fu">:</span> <span class="st">"processed/"</span><span class="fu">,</span></span>
<span id="cb3-11"><a href="#cb3-11"></a>      <span class="dt">"sink_name"</span><span class="fu">:</span> <span class="st">"table_1.csv"</span></span>
<span id="cb3-12"><a href="#cb3-12"></a>    <span class="fu">}</span></span>
<span id="cb3-13"><a href="#cb3-13"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="data-factory-configuration-2" class="level3">
<h3 class="anchored" data-anchor-id="data-factory-configuration-2">Data Factory Configuration</h3>
<p>Download the Azure Data Factory <code>.json</code> configuration file to use this template in your own data pipelines. <a href="https://raw.githubusercontent.com/nhsx/au-data-engineering/main/config-files/adf-templates/excel-sheet-ingestion.json">excel-sheet-ingestion.json</a></p>
<section id="note" class="level4">
<h4 class="anchored" data-anchor-id="note">Note</h4>
<p>Alternatively this a variation of this pipeline can be used to ingest multiple excel file sheets to a set of <code>.csv</code> files in Azure Datalake blob storage.</p>
</section>
</section>
</section>
<section id="multiple-excel-sheet-ingestion-pipeline" class="level2">
<h2 class="anchored" data-anchor-id="multiple-excel-sheet-ingestion-pipeline">Multiple Excel Sheet Ingestion Pipeline</h2>
<section id="metadata-3" class="level3">
<h3 class="anchored" data-anchor-id="metadata-3">Metadata</h3>
<ul>
<li>FILE: ingestion_multiple_excel_sheets.json</li>
<li>DESCRIPTION: Pipeline to ingest multiple specified excel file sheets as .csv files to Azure Datalake blob storage.</li>
<li>CONTRIBUTORS: Craig Shenton, Mattia Ficarelli</li>
<li>CONTACT: data@nhsx.nhs.uk</li>
<li>CREATED: 20 Sept 2021</li>
<li>VERSION: 0.0.1</li>
</ul>
</section>
<section id="description-3" class="level3">
<h3 class="anchored" data-anchor-id="description-3">Description</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../assets/images/pipeline_temps/multiple_excel_sheet_ingestion.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Data ingestion of multiple excel file sheets</figcaption><p></p>
</figure>
</div>
<p><em>Figure 4: Data ingestion of multiple excel file sheets</em></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../assets/images/pipeline_temps/multiple_excel_sheet_ingestion_2.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">ForEach loop activities within pipeline</figcaption><p></p>
</figure>
</div>
<p><em>Figure 5: ForEach loop activities within pipeline</em></p>
<p>Pipeline to ingest multiple specified excel file sheets as <code>.csv</code> files to Azure Datalake blob storage.</p>
<ol type="1">
<li>Looks up the <code>.json</code> configuration file for this pipeline.</li>
<li>Set the Azure Datalake file system.</li>
<li>Set the source path to the folder containing the excel files.</li>
<li>Set the sink path.</li>
<li>Set an <code>array</code> variable containing the list of excel file metadata.</li>
<li>ForEach loops over each excel - FILE:
<ol type="a">
<li>Sets the source sheet and sink file.</li>
<li>Copy activity ingests the excel sheet data and saves it as a <code>.csv</code> file.</li>
<li>If the copy activity fails, the error notification logic app API will notify the specified email address of the error.</li>
</ol></li>
</ol>
<section id="note-1" class="level4">
<h4 class="anchored" data-anchor-id="note-1">Note</h4>
<p>Copy activity has ‘File path type’ set to wildcard and the file name regex as <code>*.xlsx</code> (excel) (see Figure 6).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../assets/images/pipeline_temps/multiple_excel_sheet_ingestion_3.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Copy activity wildcard setup</figcaption><p></p>
</figure>
</div>
<p><em>Figure 6: Copy activity wildcard setup</em></p>
</section>
</section>
<section id="pipeline-configuration-3" class="level3">
<h3 class="anchored" data-anchor-id="pipeline-configuration-3">Pipeline Configuration</h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb4-1"><a href="#cb4-1"></a><span class="fu">{</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>  <span class="dt">"pipeline"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb4-3"><a href="#cb4-3"></a>    <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"ingestion_multiple_excel_sheets"</span><span class="fu">,</span></span>
<span id="cb4-4"><a href="#cb4-4"></a>    <span class="dt">"folder"</span><span class="fu">:</span> <span class="st">"templates/ingestion/multiple_excel_sheets"</span><span class="fu">,</span></span>
<span id="cb4-5"><a href="#cb4-5"></a>    <span class="dt">"adl_file_system"</span><span class="fu">:</span> <span class="st">"file_system"</span><span class="fu">,</span></span>
<span id="cb4-6"><a href="#cb4-6"></a>    <span class="dt">"raw"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb4-7"><a href="#cb4-7"></a>      <span class="dt">"source_path"</span><span class="fu">:</span> <span class="st">"ingestion/"</span><span class="fu">,</span></span>
<span id="cb4-8"><a href="#cb4-8"></a>      <span class="dt">"sink_path"</span><span class="fu">:</span> <span class="st">"raw/path/to/data"</span><span class="fu">,</span></span>
<span id="cb4-9"><a href="#cb4-9"></a>      <span class="dt">"sink_path"</span><span class="fu">:</span> <span class="st">"processed/"</span></span>
<span id="cb4-10"><a href="#cb4-10"></a>      <span class="st">"excel"</span><span class="er">:</span><span class="ot">[</span></span>
<span id="cb4-11"><a href="#cb4-11"></a>    <span class="fu">{</span></span>
<span id="cb4-12"><a href="#cb4-12"></a>      <span class="dt">"sink_file"</span><span class="fu">:</span> <span class="st">"table_1.csv"</span><span class="fu">,</span></span>
<span id="cb4-13"><a href="#cb4-13"></a>      <span class="dt">"source_sheet"</span><span class="fu">:</span> <span class="st">"sheet_1"</span></span>
<span id="cb4-14"><a href="#cb4-14"></a>    <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb4-15"><a href="#cb4-15"></a>    <span class="fu">{</span></span>
<span id="cb4-16"><a href="#cb4-16"></a>      <span class="dt">"sink_file"</span><span class="fu">:</span> <span class="st">"table_2.csv"</span><span class="fu">,</span></span>
<span id="cb4-17"><a href="#cb4-17"></a>      <span class="dt">"source_sheet"</span><span class="fu">:</span> <span class="st">"sheet_2"</span></span>
<span id="cb4-18"><a href="#cb4-18"></a>    <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb4-19"><a href="#cb4-19"></a>    <span class="fu">{</span></span>
<span id="cb4-20"><a href="#cb4-20"></a>      <span class="dt">"sink_file"</span><span class="fu">:</span> <span class="st">"table_3.csv"</span><span class="fu">,</span></span>
<span id="cb4-21"><a href="#cb4-21"></a>      <span class="dt">"source_sheet"</span><span class="fu">:</span> <span class="st">"sheet_3"</span></span>
<span id="cb4-22"><a href="#cb4-22"></a>    <span class="fu">}</span></span>
<span id="cb4-23"><a href="#cb4-23"></a>  <span class="ot">]</span></span>
<span id="cb4-24"><a href="#cb4-24"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="data-factory-configuration-3" class="level3">
<h3 class="anchored" data-anchor-id="data-factory-configuration-3">Data Factory Configuration</h3>
<p>Download the Azure Data Factory <code>.json</code> configuration file to use this template in your own data pipelines.</p>
<p><a href="https://raw.githubusercontent.com/nhsx/au-data-engineering/main/config-files/adf-templates/multiple-excel-sheet-ingestion.json">multiple-excel-sheet-ingestion.json</a></p>
</section>
</section>
<section id="web-url-data-ingestion-pipeline" class="level2">
<h2 class="anchored" data-anchor-id="web-url-data-ingestion-pipeline">Web URL Data Ingestion Pipeline</h2>
<section id="metadata-4" class="level3">
<h3 class="anchored" data-anchor-id="metadata-4">Metadata</h3>
<ul>
<li>FILE: ingestion_web_url.json</li>
<li>DESCRIPTION: Pipeline to ingest data from a URL as a .csv file to Azure Datalake blob storage.</li>
<li>CONTRIBUTORS: Craig Shenton, Mattia Ficarelli</li>
<li>CONTACT: data@nhsx.nhs.uk</li>
<li>CREATED: 20 Sept 2021</li>
<li>VERSION: 0.0.1</li>
</ul>
</section>
<section id="description-4" class="level3">
<h3 class="anchored" data-anchor-id="description-4">Description</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../assets/images/pipeline_temps/web_url_ingestion.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Data ingestion from a web URL</figcaption><p></p>
</figure>
</div>
<p><em>Figure 7: Data ingestion from a web URL</em></p>
<p>Pipeline to ingest data from a web URL as a <code>.csv</code> file to Azure Datalake blob storage.</p>
<ol type="1">
<li>Lookup the <code>.json</code> configuration file for this pipeline.</li>
<li>Set the source URL.</li>
<li>Set the file system.</li>
<li>Set the sink path.</li>
<li>Set the sink file.</li>
<li>Copy activity copies the data returned from the URL as a <code>.csv</code> file.</li>
<li>If the copy activity fails, the error notification logic app API will notify the specified email address of the error.</li>
</ol>
</section>
<section id="pipeline-configuration-4" class="level3">
<h3 class="anchored" data-anchor-id="pipeline-configuration-4">Pipeline Configuration</h3>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb5-1"><a href="#cb5-1"></a><span class="fu">{</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>  <span class="dt">"pipeline"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb5-3"><a href="#cb5-3"></a>    <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"ingestion_web_url"</span><span class="fu">,</span></span>
<span id="cb5-4"><a href="#cb5-4"></a>    <span class="dt">"folder"</span><span class="fu">:</span> <span class="st">"templates/ingestion/web_url"</span><span class="fu">,</span></span>
<span id="cb5-5"><a href="#cb5-5"></a>    <span class="dt">"adl_file_system"</span><span class="fu">:</span> <span class="st">"file_system"</span><span class="fu">,</span></span>
<span id="cb5-6"><a href="#cb5-6"></a>    <span class="dt">"raw"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb5-7"><a href="#cb5-7"></a>      <span class="dt">"source_url"</span><span class="fu">:</span> <span class="st">"https://www.sourcedata.com"</span><span class="fu">,</span></span>
<span id="cb5-8"><a href="#cb5-8"></a>      <span class="dt">"sink_path"</span><span class="fu">:</span> <span class="st">"raw/path/to/data"</span><span class="fu">,</span></span>
<span id="cb5-9"><a href="#cb5-9"></a>      <span class="dt">"sink_file"</span><span class="fu">:</span> <span class="st">"table_1.csv"</span></span>
<span id="cb5-10"><a href="#cb5-10"></a>    <span class="fu">}</span></span>
<span id="cb5-11"><a href="#cb5-11"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="data-factory-configuration-4" class="level3">
<h3 class="anchored" data-anchor-id="data-factory-configuration-4">Data Factory Configuration</h3>
<p>Download the Azure Data Factory <code>.json</code> configuration file to use this template in your own data pipelines.</p>
<p><a href="https://raw.githubusercontent.com/nhsx/au-data-engineering/main/config-files/adf-templates/web-url-ingestion.json">web-url-ingestion.json</a></p>
</section>
</section>
<section id="azure-function-app-ingestion-pipeline" class="level2">
<h2 class="anchored" data-anchor-id="azure-function-app-ingestion-pipeline">Azure Function App Ingestion Pipeline</h2>
<section id="metadata-5" class="level3">
<h3 class="anchored" data-anchor-id="metadata-5">Metadata</h3>
<ul>
<li>FILE: ingestion_function_app.json</li>
<li>DESCRIPTION: Pipeline to ingest raw data to Azure Datalake blob storage using an Azure function app.</li>
<li>CONTRIBUTORS: Craig Shenton, Mattia Ficarelli</li>
<li>CONTACT: data@nhsx.nhs.uk</li>
<li>CREATED: 29 Sept 2021</li>
<li>VERSION: 0.0.1</li>
</ul>
</section>
<section id="description-5" class="level3">
<h3 class="anchored" data-anchor-id="description-5">Description</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../assets/images/pipeline_temps/function_app_ingestion.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Data ingestion using an azure function app</figcaption><p></p>
</figure>
</div>
<p><em>Figure 8: Data ingestion using an azure function app</em></p>
<p>Pipeline to ingest raw data to Azure Datalake blob storage using an Azure function app.</p>
<ol type="1">
<li>Lookup the <code>.json</code> configuration file for this pipeline.</li>
<li>Set the Azure function app.</li>
<li>Azure function app activity triggers the specified function app.</li>
<li>If the Azure function app activity fails, the error notification logic app API will notify the specified email address of the error.</li>
</ol>
<p>Within the Azure function app data can be saved to blob storage as either a <code>.csv</code> file or a <code>.parquet</code> file.</p>
</section>
<section id="pipeline-configuration-5" class="level3">
<h3 class="anchored" data-anchor-id="pipeline-configuration-5">Pipeline Configuration</h3>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb6-1"><a href="#cb6-1"></a><span class="fu">{</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>  <span class="dt">"pipeline"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb6-3"><a href="#cb6-3"></a>    <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"ingestion_function_app"</span><span class="fu">,</span></span>
<span id="cb6-4"><a href="#cb6-4"></a>    <span class="dt">"folder"</span><span class="fu">:</span> <span class="st">"templates/ingestion/function_app"</span><span class="fu">,</span></span>
<span id="cb6-5"><a href="#cb6-5"></a>    <span class="dt">"adl_file_system"</span><span class="fu">:</span> <span class="st">"file_system"</span><span class="fu">,</span></span>
<span id="cb6-6"><a href="#cb6-6"></a>    <span class="dt">"raw"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb6-7"><a href="#cb6-7"></a>      <span class="dt">"func_name"</span><span class="fu">:</span> <span class="st">"azure_func_app"</span></span>
<span id="cb6-8"><a href="#cb6-8"></a>    <span class="fu">}</span></span>
<span id="cb6-9"><a href="#cb6-9"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="data-factory-configuration-5" class="level3">
<h3 class="anchored" data-anchor-id="data-factory-configuration-5">Data Factory Configuration</h3>
<p>Download the Azure Data Factory <code>.json</code> configuration file to use this template in your own data pipelines.</p>
<p><a href="https://raw.githubusercontent.com/nhsx/au-data-engineering/main/config-files/adf-templates/function-app-ingestion.json">function-app-ingestion.json</a></p>
</section>
</section>
<section id="sharepoint-ingestion-pipeline" class="level2">
<h2 class="anchored" data-anchor-id="sharepoint-ingestion-pipeline">SharePoint Ingestion Pipeline</h2>
<section id="metadata-6" class="level3">
<h3 class="anchored" data-anchor-id="metadata-6">Metadata</h3>
<ul>
<li>FILE: ingestion_sharepoint.json</li>
<li>DESCRIPTION: Pipeline to ingest a specified folder and files from Microsoft SharePoint to Azure Datalake blob storage.</li>
<li>CONTRIBUTORS: Craig Shenton, Mattia Ficarelli</li>
<li>CONTACT: data@nhsx.nhs.uk</li>
<li>CREATED: 29 Sept 2021</li>
<li>VERSION: 0.0.1</li>
</ul>
</section>
<section id="description-6" class="level3">
<h3 class="anchored" data-anchor-id="description-6">Description</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../assets/images/pipeline_temps/sharepoint_ingestion.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Data ingestion from microsoft sharepoint</figcaption><p></p>
</figure>
</div>
<p><em>Figure 9: Data ingestion from microsoft sharepoint</em></p>
<p>Pipeline to ingest a specified folder from Microsoft SharePoint to Azure Datalake blob storage.</p>
<ol type="1">
<li>Lookup the <code>.json</code> configuration file for this pipeline.</li>
<li>Set the SharePoint file path and SharePoint logic app URL.</li>
<li>Call the SharePoint logic app using a webhook that will send back a message once the file transfer is complete.</li>
<li>If the logic app fails, the error notification logic app API will notify the specified email address of the error.</li>
</ol>
</section>
<section id="pipeline-configuration-6" class="level3">
<h3 class="anchored" data-anchor-id="pipeline-configuration-6">Pipeline Configuration</h3>
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb7-1"><a href="#cb7-1"></a><span class="fu">{</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>  <span class="dt">"pipeline"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb7-3"><a href="#cb7-3"></a>    <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"ingestion_sharepoint"</span><span class="fu">,</span></span>
<span id="cb7-4"><a href="#cb7-4"></a>    <span class="dt">"folder"</span><span class="fu">:</span> <span class="st">"templates/ingestion/sharepoint"</span><span class="fu">,</span></span>
<span id="cb7-5"><a href="#cb7-5"></a>    <span class="dt">"adl_file_system"</span><span class="fu">:</span> <span class="st">"file_system"</span><span class="fu">,</span></span>
<span id="cb7-6"><a href="#cb7-6"></a>    <span class="dt">"raw"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb7-7"><a href="#cb7-7"></a>      <span class="dt">"source_path"</span><span class="fu">:</span> <span class="st">"...sharepoint/..."</span><span class="fu">,</span></span>
<span id="cb7-8"><a href="#cb7-8"></a>      <span class="dt">"logic_app_url"</span><span class="fu">:</span> <span class="st">"https://...logic.azure.com/..."</span></span>
<span id="cb7-9"><a href="#cb7-9"></a>    <span class="fu">}</span></span>
<span id="cb7-10"><a href="#cb7-10"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="data-factory-configuration-6" class="level3">
<h3 class="anchored" data-anchor-id="data-factory-configuration-6">Data Factory Configuration</h3>
<p>Download the Azure Data Factory <code>.json</code> configuration file to use this template in your own data pipelines.</p>
<p><a href="https://raw.githubusercontent.com/nhsx/au-data-engineering/main/config-files/adf-templates/sharepoint-ingestion.json">sharepoint-ingestion.json</a></p>
</section>
</section>
<section id="databricks-processing-pipeline" class="level2">
<h2 class="anchored" data-anchor-id="databricks-processing-pipeline">Databricks Processing Pipeline</h2>
<section id="metadata-7" class="level3">
<h3 class="anchored" data-anchor-id="metadata-7">Metadata</h3>
<ul>
<li>FILE: processing_databricks.json</li>
<li>DESCRIPTION: Pipeline to process data from a folder in Azure Datalake blob storage using a databricks notebook.</li>
<li>CONTRIBUTORS: Craig Shenton, Mattia Ficarelli</li>
<li>CONTACT: data@nhsx.nhs.uk</li>
<li>CREATED: 23 Sept 2021</li>
<li>VERSION: 0.0.1</li>
</ul>
</section>
<section id="description-7" class="level3">
<h3 class="anchored" data-anchor-id="description-7">Description</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../assets/images/pipeline_temps/databricks/databricks.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Data processing using a Databricks notebook</figcaption><p></p>
</figure>
</div>
<p><em>Figure 10: Data processing using a Databricks notebook</em></p>
<p>Pipeline to process data from a folder in Azure Datalake blob storage using a databricks notebook</p>
<ol type="1">
<li>Lookup the <code>.json</code> configuration file for this pipeline.</li>
<li>Set the databricks notebook path.</li>
<li>Databricks notebook activity runs the databricks notebook specified using an ephemeral job cluster.</li>
<li>If the databricks notebook activity fails, the error notification logic app API will notify the specified email address of the error.</li>
</ol>
</section>
<section id="pipeline-configuration-7" class="level3">
<h3 class="anchored" data-anchor-id="pipeline-configuration-7">Pipeline Configuration</h3>
<div class="sourceCode" id="cb8"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb8-1"><a href="#cb8-1"></a><span class="fu">{</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>  <span class="dt">"pipeline"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb8-3"><a href="#cb8-3"></a>    <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"processing_databricks"</span><span class="fu">,</span></span>
<span id="cb8-4"><a href="#cb8-4"></a>    <span class="dt">"folder"</span><span class="fu">:</span> <span class="st">"templates/processing/databricks"</span><span class="fu">,</span></span>
<span id="cb8-5"><a href="#cb8-5"></a>    <span class="dt">"project"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb8-6"><a href="#cb8-6"></a>      <span class="dt">"databricks_notebook"</span><span class="fu">:</span> <span class="st">"/path/to/databricks/notebook"</span></span>
<span id="cb8-7"><a href="#cb8-7"></a>    <span class="fu">}</span></span>
<span id="cb8-8"><a href="#cb8-8"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="databricks-orchestration" class="level3">
<h3 class="anchored" data-anchor-id="databricks-orchestration">Databricks Orchestration</h3>
<section id="note-2" class="level4">
<h4 class="anchored" data-anchor-id="note-2">Note</h4>
<p>Alternatively this pipeline can be used to trigger an orchestrator databricks notebook which in turn runs a series of data processing notebooks.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb9-1"><a href="#cb9-1"></a><span class="fu">{</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>  <span class="dt">"pipeline"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb9-3"><a href="#cb9-3"></a>    <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"processing_databricks"</span><span class="fu">,</span></span>
<span id="cb9-4"><a href="#cb9-4"></a>    <span class="dt">"folder"</span><span class="fu">:</span> <span class="st">"templates/processing/databricks_orchestrator"</span><span class="fu">,</span></span>
<span id="cb9-5"><a href="#cb9-5"></a>    <span class="dt">"project"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb9-6"><a href="#cb9-6"></a>      <span class="dt">"databricks_orchestrator_notebook"</span><span class="fu">:</span> <span class="st">"/path/to/databricks/orchestrator_notebook"</span></span>
<span id="cb9-7"><a href="#cb9-7"></a>      <span class="st">"databricks"</span><span class="er">:</span><span class="ot">[</span>    </span>
<span id="cb9-8"><a href="#cb9-8"></a>          <span class="fu">{</span></span>
<span id="cb9-9"><a href="#cb9-9"></a>        <span class="dt">"sink_path"</span><span class="fu">:</span> <span class="st">"path/to/processed/data"</span><span class="fu">,</span></span>
<span id="cb9-10"><a href="#cb9-10"></a>        <span class="dt">"sink_file"</span><span class="fu">:</span> <span class="st">"file_1.csv"</span><span class="fu">,</span></span>
<span id="cb9-11"><a href="#cb9-11"></a>        <span class="dt">"databricks_notebook"</span><span class="fu">:</span> <span class="st">"/path/to/databricks/processing_notebook1"</span></span>
<span id="cb9-12"><a href="#cb9-12"></a>        <span class="fu">}</span><span class="ot">,</span>    </span>
<span id="cb9-13"><a href="#cb9-13"></a>          <span class="fu">{</span></span>
<span id="cb9-14"><a href="#cb9-14"></a>        <span class="dt">"sink_path"</span><span class="fu">:</span> <span class="st">"path/to/processed/data"</span><span class="fu">,</span></span>
<span id="cb9-15"><a href="#cb9-15"></a>        <span class="dt">"sink_file"</span><span class="fu">:</span> <span class="st">"file_2.csv"</span><span class="fu">,</span></span>
<span id="cb9-16"><a href="#cb9-16"></a>        <span class="dt">"databricks_notebook"</span><span class="fu">:</span> <span class="st">"/path/to/databricks/processing_notebook2"</span></span>
<span id="cb9-17"><a href="#cb9-17"></a>        <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb9-18"><a href="#cb9-18"></a>    <span class="er">}</span></span>
<span id="cb9-19"><a href="#cb9-19"></a><span class="er">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Python code to sequentially run databricks notebook paths specified in a <code>.json</code> config file from a databricks orchestrator notebook.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1"></a><span class="co">#Squentially run datbricks notebooks</span></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="cf">for</span> index, item <span class="kw">in</span> <span class="bu">enumerate</span>(config_JSON[<span class="st">'pipeline'</span>][<span class="st">'project'</span>][<span class="st">'databricks'</span>]): </span>
<span id="cb10-3"><a href="#cb10-3"></a>notebook <span class="op">=</span> config_JSON[<span class="st">'pipeline'</span>][<span class="st">'project'</span>][<span class="st">'databricks'</span>][index][<span class="st">'databricks_notebook'</span>]</span>
<span id="cb10-4"><a href="#cb10-4"></a>    dbutils.notebook.run(notebook, <span class="dv">120</span>)</span>
<span id="cb10-5"><a href="#cb10-5"></a>  <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb10-6"><a href="#cb10-6"></a>    <span class="bu">print</span>(e)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="data-factory-configuration-7" class="level3">
<h3 class="anchored" data-anchor-id="data-factory-configuration-7">Data Factory Configuration</h3>
<p>Download the Azure Data Factory <code>.json</code> configuration file to use this template in your own data pipelines.</p>
<p><a href="https://raw.githubusercontent.com/nhsx/au-data-engineering/main/config-files/adf-templates/databricks-processing.json">processing-databricks.json</a></p>
</section>
</section>
<section id="azure-function-app-processing-pipeline" class="level2">
<h2 class="anchored" data-anchor-id="azure-function-app-processing-pipeline">Azure Function App Processing Pipeline</h2>
<section id="metadata-8" class="level3">
<h3 class="anchored" data-anchor-id="metadata-8">Metadata</h3>
<ul>
<li>FILE: processing_function_app.json</li>
<li>DESCRIPTION: Pipeline to process data to time-stamped folder in Azure Datalake blob storage using an Azure function app.</li>
<li>CONTRIBUTORS: Craig Shenton, Mattia Ficarelli</li>
<li>CONTACT: data@nhsx.nhs.uk</li>
<li>CREATED: 29 Sept 2021</li>
<li>VERSION: 0.0.1</li>
</ul>
</section>
<section id="description-8" class="level3">
<h3 class="anchored" data-anchor-id="description-8">Description</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../assets/images/pipeline_temps/function_app_processing.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Data processing using an azure function app</figcaption><p></p>
</figure>
</div>
<p><em>Figure 11: Data processing using an azure function app</em></p>
<section id="note-3" class="level4">
<h4 class="anchored" data-anchor-id="note-3">Note</h4>
<p>This pipeline is designed to allow for raw data to be ingested and then appended onto an existing table with historical data.</p>
<p>Pipeline to process data to time-stamped folder in Azure Datalake blob storage using an Azure function app.</p>
<ol type="1">
<li>Lookup the <code>.json</code> configuration file for this pipeline.</li>
<li>Set the source path (of the data to be processed).</li>
<li>Set the file system.</li>
<li>Set the Azure function app.</li>
<li>Use the ‘laterFolder’ utility to find and save the latest folder in the source path.</li>
<li>If the ‘laterFolder’ utility fails, the error notification logic app API will notify the specified email address of the error.</li>
<li>Lookup the latest folder.</li>
<li>Set the latest folder.</li>
<li>Set the <code>.json</code> body for the Azure function app.</li>
<li>Run the Azure function app activity.</li>
<li>If the Azure function app activity fails, the error notification logic app API will notify the specified email address of the error.</li>
</ol>
<p>Within the Azure function app data can be saved to blob storage as either a <code>.csv</code> file or a <code>.parquet</code> file.</p>
</section>
</section>
<section id="pipeline-configuration-8" class="level3">
<h3 class="anchored" data-anchor-id="pipeline-configuration-8">Pipeline Configuration</h3>
<div class="sourceCode" id="cb11"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb11-1"><a href="#cb11-1"></a><span class="fu">{</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>  <span class="dt">"pipeline"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb11-3"><a href="#cb11-3"></a>    <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"processing_function_app"</span><span class="fu">,</span></span>
<span id="cb11-4"><a href="#cb11-4"></a>    <span class="dt">"folder"</span><span class="fu">:</span> <span class="st">"templates/processing/function_app"</span><span class="fu">,</span></span>
<span id="cb11-5"><a href="#cb11-5"></a>    <span class="dt">"adl_file_system"</span><span class="fu">:</span> <span class="st">"file_system"</span><span class="fu">,</span></span>
<span id="cb11-6"><a href="#cb11-6"></a>    <span class="dt">"project"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb11-7"><a href="#cb11-7"></a>      <span class="dt">"func_name"</span><span class="fu">:</span> <span class="st">"azure_func_app"</span><span class="fu">,</span></span>
<span id="cb11-8"><a href="#cb11-8"></a>      <span class="dt">"source_path"</span><span class="fu">:</span> <span class="st">"raw/historical/data/source"</span></span>
<span id="cb11-9"><a href="#cb11-9"></a>    <span class="fu">}</span></span>
<span id="cb11-10"><a href="#cb11-10"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="data-factory-configuration-8" class="level3">
<h3 class="anchored" data-anchor-id="data-factory-configuration-8">Data Factory Configuration</h3>
<p>Download the Azure Data Factory <code>.json</code> configuration file to use this template in your own data pipelines.</p>
<p><a href="https://raw.githubusercontent.com/nhsx/au-data-engineering/main/config-files/adf-templates/function-app-processing.json">function-app-processing.json</a></p>
</section>
</section>
<section id="multiple-azure-function-apps-processing-pipeline" class="level2">
<h2 class="anchored" data-anchor-id="multiple-azure-function-apps-processing-pipeline">Multiple Azure Function Apps Processing Pipeline</h2>
<section id="metadata-9" class="level3">
<h3 class="anchored" data-anchor-id="metadata-9">Metadata</h3>
<ul>
<li>FILE: processing_multiple_function_apps.json</li>
<li>DESCRIPTION: Pipeline to process data to time-stamped folders in Azure Datalake blob storage using multiple Azure function apps.</li>
<li>CONTRIBUTORS: Craig Shenton, Mattia Ficarelli</li>
<li>CONTACT: data@nhsx.nhs.uk</li>
<li>CREATED: 29 Sept 2021</li>
<li>VERSION: 0.0.1</li>
</ul>
</section>
<section id="description-9" class="level3">
<h3 class="anchored" data-anchor-id="description-9">Description</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../assets/images/pipeline_temps/multiple_function_app_processing.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Data processing using multiple azure function apps</figcaption><p></p>
</figure>
</div>
<p><em>Figure 12: Data processing using multiple azure function apps</em></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../assets/images/pipeline_temps/multiple_function_app_processing_2.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">ForEach loop activities within pipeline</figcaption><p></p>
</figure>
</div>
<p><em>Figure 13: ForEach loop activities within pipeline</em></p>
<section id="note-4" class="level4">
<h4 class="anchored" data-anchor-id="note-4">Note</h4>
<p>This pipeline allows for multiple different processed data files to be generated from the same data source during a pipeline run by using multiple function apps running sequentially.</p>
<p>Pipeline to process data to time-stamped folder in Azure Datalake blob storage using multiple Azure function apps.</p>
<ol type="1">
<li>Lookup the <code>.json</code> configuration file for this pipeline.</li>
<li>Set the source path (of the data to be processed).</li>
<li>Set the file system.</li>
<li>Set the Azure function app.</li>
<li>Use the ‘laterFolder’ utility to find and save the latest folder in the source path.</li>
<li>If the ‘laterFolder’ utility fails, the error notification logic app API will notify the specified email address of the error.</li>
<li>Lookup the latest folder.</li>
<li>Set the latest folder.</li>
<li>Set the <code>.json</code> body for the Azure function app.</li>
<li>Set an <code>array</code> variable containing the list of Azure function apps to be run.</li>
<li>ForEach loops over each azure function: &gt;</li>
</ol>
<ol type="a">
<li>Runs the Azure function app activity.</li>
<li>If the Azure function app activity fails, the error notification logic app API will notify the specified email address of the error.</li>
</ol>
<p>Within the Azure function app data can be saved to blob storage as either a <code>.csv</code> file or a <code>.parquet</code> file.</p>
</section>
</section>
<section id="pipeline-configuration-9" class="level3">
<h3 class="anchored" data-anchor-id="pipeline-configuration-9">Pipeline Configuration</h3>
<div class="sourceCode" id="cb12"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb12-1"><a href="#cb12-1"></a><span class="fu">{</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>  <span class="dt">"pipeline"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb12-3"><a href="#cb12-3"></a>    <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"processing_function_app"</span><span class="fu">,</span></span>
<span id="cb12-4"><a href="#cb12-4"></a>    <span class="dt">"folder"</span><span class="fu">:</span> <span class="st">"templates/processing/function_app"</span><span class="fu">,</span></span>
<span id="cb12-5"><a href="#cb12-5"></a>    <span class="dt">"adl_file_system"</span><span class="fu">:</span> <span class="st">"file_system"</span><span class="fu">,</span></span>
<span id="cb12-6"><a href="#cb12-6"></a>    <span class="dt">"project"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb12-7"><a href="#cb12-7"></a>      <span class="dt">"functions"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb12-8"><a href="#cb12-8"></a>        <span class="fu">{</span><span class="dt">"func_name"</span><span class="fu">:</span> <span class="st">"azure_func_app_1"</span><span class="fu">}</span><span class="ot">,</span></span>
<span id="cb12-9"><a href="#cb12-9"></a>        <span class="fu">{</span><span class="dt">"func_name"</span><span class="fu">:</span> <span class="st">"azure_func_app_2"</span><span class="fu">}</span><span class="ot">,</span></span>
<span id="cb12-10"><a href="#cb12-10"></a>        <span class="fu">{</span><span class="dt">"func_name"</span><span class="fu">:</span> <span class="st">"azure_func_app_3"</span><span class="fu">}</span></span>
<span id="cb12-11"><a href="#cb12-11"></a>            <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb12-12"><a href="#cb12-12"></a>      <span class="dt">"source_path"</span><span class="fu">:</span> <span class="st">"raw/historical/data/source"</span></span>
<span id="cb12-13"><a href="#cb12-13"></a>    <span class="fu">}</span></span>
<span id="cb12-14"><a href="#cb12-14"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="data-factory-configuration-9" class="level3">
<h3 class="anchored" data-anchor-id="data-factory-configuration-9">Data Factory Configuration</h3>
<p>Download the Azure Data Factory <code>.json</code> configuration file to use this template in your own data pipelines.</p>
<p><a href="https://raw.githubusercontent.com/nhsx/au-data-engineering/main/config-files/adf-templates/multiple-function-app-processing.json">multiple-function-app-processing.json</a></p>
</section>
</section>
<section id="copy-file-processing-pipeline" class="level2">
<h2 class="anchored" data-anchor-id="copy-file-processing-pipeline">Copy File Processing Pipeline</h2>
<section id="metadata-10" class="level3">
<h3 class="anchored" data-anchor-id="metadata-10">Metadata</h3>
<ul>
<li><p>FILE: processing_csv_file.json</p></li>
<li><p>DESCRIPTION: Pipeline to copy a .csv file in a time-stamped folder between directories in Azure Datalake blob storage.</p></li>
<li><p>CONTRIBUTORS: Craig Shenton, Mattia Ficarelli</p></li>
<li><p>CONTACT: data@nhsx.nhs.uk</p></li>
<li><p>CREATED: 29 Sept 2021</p></li>
<li><p>VERSION: 0.0.1</p></li>
</ul>
</section>
<section id="description-10" class="level3">
<h3 class="anchored" data-anchor-id="description-10">Description</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../assets/images/pipeline_temps/csv_file_processing.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Copying a .csv file between Azure Datalake directories</figcaption><p></p>
</figure>
</div>
<p><em>Figure 14: Copying a <code>.csv</code> file between Azure Datalake directories</em></p>
<p>Pipeline to copy a <code>.csv</code> file in a time-stamped folder between directories in Azure Datalake blob storage.</p>
<ol type="1">
<li>Lookup the <code>.json</code> configuration file for this pipeline.</li>
<li>Set the Azure Datalake file system</li>
<li>Set the source path and source file name.</li>
<li>Set the sink path and sink file name.</li>
<li>Use the ‘laterFolder’ utility to find and save the latest folder in the source path.</li>
<li>If the ‘laterFolder’ utility fails, the error notification logic app API will notify the specified email address of the error.</li>
<li>Lookup the latest folder.</li>
<li>Set the latest folder.</li>
<li>Copy activity copies the <code>.csv</code> file between the Datalake directories.</li>
<li>If the copy activity fails, the error notification logic app API will notify the specified email address of the error.</li>
</ol>
</section>
<section id="pipeline-configuration-10" class="level3">
<h3 class="anchored" data-anchor-id="pipeline-configuration-10">Pipeline Configuration</h3>
<div class="sourceCode" id="cb13"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb13-1"><a href="#cb13-1"></a><span class="fu">{</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>  <span class="dt">"pipeline"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb13-3"><a href="#cb13-3"></a>    <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"processing_csv_file"</span><span class="fu">,</span></span>
<span id="cb13-4"><a href="#cb13-4"></a>    <span class="dt">"folder"</span><span class="fu">:</span> <span class="st">"templates/processing/csv_file"</span><span class="fu">,</span></span>
<span id="cb13-5"><a href="#cb13-5"></a>    <span class="dt">"adl_file_system"</span><span class="fu">:</span> <span class="st">"file_system"</span><span class="fu">,</span></span>
<span id="cb13-6"><a href="#cb13-6"></a>    <span class="dt">"project"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb13-7"><a href="#cb13-7"></a>      <span class="dt">"source_path"</span><span class="fu">:</span> <span class="st">"raw/"</span><span class="fu">,</span></span>
<span id="cb13-8"><a href="#cb13-8"></a>      <span class="dt">"source_name"</span><span class="fu">:</span> <span class="st">"file.csv"</span><span class="fu">,</span></span>
<span id="cb13-9"><a href="#cb13-9"></a>      <span class="dt">"sink_path"</span><span class="fu">:</span> <span class="st">"proc/"</span><span class="fu">,</span></span>
<span id="cb13-10"><a href="#cb13-10"></a>      <span class="dt">"sink_name"</span><span class="fu">:</span> <span class="st">"file_copy.csv"</span></span>
<span id="cb13-11"><a href="#cb13-11"></a>    <span class="fu">}</span></span>
<span id="cb13-12"><a href="#cb13-12"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="data-factory-configuration-10" class="level3">
<h3 class="anchored" data-anchor-id="data-factory-configuration-10">Data Factory Configuration</h3>
<p>Download the Azure Data Factory <code>.json</code> configuration file to use this template in your own data pipelines.</p>
<p><a href="https://raw.githubusercontent.com/nhsx/au-data-engineering/main/config-files/adf-templates/csv-file-processing.json">csv-file-processing.json</a></p>
</section>
</section>
<section id="sql-table-staging-pipeline" class="level2">
<h2 class="anchored" data-anchor-id="sql-table-staging-pipeline">SQL Table Staging Pipeline</h2>
<section id="metadata-11" class="level3">
<h3 class="anchored" data-anchor-id="metadata-11">Metadata</h3>
<ul>
<li>FILE: staging_sql_database.json</li>
<li>DESCRIPTION: Pipeline to stage data from a time-stamped folder in Azure Datalake blob storage to a table in an Azure SQL database.</li>
<li>CONTRIBUTORS: Craig Shenton, Mattia Ficarelli</li>
<li>CONTACT: data@nhsx.nhs.uk</li>
<li>CREATED: 29 Sept 2021</li>
<li>VERSION: 0.0.1</li>
</ul>
</section>
<section id="description-11" class="level3">
<h3 class="anchored" data-anchor-id="description-11">Description</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../assets/images/pipeline_temps/sql_database_staging.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Data staging to a table in an Azure SQL database</figcaption><p></p>
</figure>
</div>
<p><em>Figure 15: Data staging to a table in an Azure SQL database</em></p>
<p>Pipeline to stage data (<code>.csv</code> file) from a time-stamped folder in Azure Datalake blob storage to a table in an Azure SQL database.</p>
<ol type="1">
<li>Lookup the <code>.json</code> configuration file for this pipeline.</li>
<li>Set the source path (of data to be staged).</li>
<li>Set the source file.</li>
<li>Set the file system.</li>
<li>Set the sink table (target table in the SQL database).</li>
<li>Set the stored procedure (truncates data in the target table in the SQL database).</li>
<li>Run the stored procedure activity. The stored procedure also sets the data type of each column in the database table.</li>
<li>Use the ‘laterFolder’ utility to find and save the latest folder in the source path.</li>
<li>If the ‘laterFolder’ utility fails, the error notification logic app API will notify the specified email address of the error.</li>
<li>Lookup the latest folder.</li>
<li>Set the latest folder.</li>
<li>Run the copy activity which stages data from a <code>.csv</code> file in Azure Datalake blob storage to an empty table in an Azure SQL database.</li>
<li>If the Azure copy activity fails, the error notification logic app API will notify the specified email address of the error.</li>
</ol>
</section>
<section id="pipeline-configuration-11" class="level3">
<h3 class="anchored" data-anchor-id="pipeline-configuration-11">Pipeline Configuration</h3>
<div class="sourceCode" id="cb14"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb14-1"><a href="#cb14-1"></a><span class="fu">{</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>  <span class="dt">"pipeline"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb14-3"><a href="#cb14-3"></a>    <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"staging_sql_database"</span><span class="fu">,</span></span>
<span id="cb14-4"><a href="#cb14-4"></a>    <span class="dt">"folder"</span><span class="fu">:</span> <span class="st">"templates/staging/sql_database"</span><span class="fu">,</span></span>
<span id="cb14-5"><a href="#cb14-5"></a>    <span class="dt">"adl_file_system"</span><span class="fu">:</span> <span class="st">"file_system"</span><span class="fu">,</span></span>
<span id="cb14-6"><a href="#cb14-6"></a>    <span class="dt">"staging"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb14-7"><a href="#cb14-7"></a>        <span class="dt">"stored_procedure"</span><span class="fu">:</span><span class="st">"[dbo].[sql_stored_procedure_table_1]"</span><span class="fu">,</span></span>
<span id="cb14-8"><a href="#cb14-8"></a>        <span class="dt">"source_path"</span><span class="fu">:</span><span class="st">"proc/projects/path/to/processed/data/"</span><span class="fu">,</span></span>
<span id="cb14-9"><a href="#cb14-9"></a>        <span class="dt">"source_file"</span><span class="fu">:</span><span class="st">"table_1.csv"</span><span class="fu">,</span></span>
<span id="cb14-10"><a href="#cb14-10"></a>        <span class="dt">"sink_table"</span><span class="fu">:</span><span class="st">"sql_table_1"</span></span>
<span id="cb14-11"><a href="#cb14-11"></a>    <span class="fu">}</span></span>
<span id="cb14-12"><a href="#cb14-12"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="data-factory-configuration-11" class="level3">
<h3 class="anchored" data-anchor-id="data-factory-configuration-11">Data Factory Configuration</h3>
<p>Download the Azure Data Factory <code>.json</code> configuration file to use this template in your own data pipelines.</p>
<p><a href="https://raw.githubusercontent.com/nhsx/au-data-engineering/main/config-files/adf-templates/staging-sql-database.json">sql-database-staging.json</a></p>
</section>
</section>
<section id="multiple-sql-table-staging-pipeline" class="level2">
<h2 class="anchored" data-anchor-id="multiple-sql-table-staging-pipeline">Multiple SQL Table Staging Pipeline</h2>
<section id="metadata-12" class="level3">
<h3 class="anchored" data-anchor-id="metadata-12">Metadata</h3>
<ul>
<li>FILE: multiple_tables_staging_sql_database.json</li>
<li>DESCRIPTION: Pipeline to stage data from a time-stamped folders in Azure Datalake blob storage to multiple tables in an Azure SQL database.</li>
<li>CONTRIBUTORS: Craig Shenton, Mattia Ficarelli</li>
<li>CONTACT: data@nhsx.nhs.uk</li>
<li>CREATED: 29 Sept 2021</li>
<li>VERSION: 0.0.1</li>
</ul>
</section>
<section id="description-12" class="level3">
<h3 class="anchored" data-anchor-id="description-12">Description</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../assets/images/pipeline_temps/multiple_table_sql_database_staging.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Data staging to multiple tables in an Azure SQL database</figcaption><p></p>
</figure>
</div>
<p><em>Figure 16: Data staging to multiple tables in an Azure SQL database</em></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../assets/images/pipeline_temps/multiple_table_sql_database_staging_2.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">ForEach loop activities within pipeline</figcaption><p></p>
</figure>
</div>
<p><em>Figure 17: ForEach loop activities within pipeline</em></p>
<p>Pipeline to stage data (<code>.csv</code> files) from a time-stamped folders in Azure Datalake blob storage to multiple tables in an Azure SQL database.</p>
<ol type="1">
<li>Lookup the <code>.json</code> configuration file for this pipeline.</li>
<li>Set the file system.</li>
<li>Set an <code>array</code> variable containing the list of stored procedures and tables to which processed data is to be staged.</li>
<li>For each element in the list the ForEach loop:
<ol type="a">
<li>Sets the source path (of data to be staged).</li>
<li>Sets the source file.</li>
<li>Uses the ‘laterFolder’ utility to find and save the latest folder in the source path.</li>
<li>Lookups the latest folder.</li>
<li>Sets the latest folder.</li>
<li>Sets the sink table (target table in the SQL database).</li>
<li>Sets the stored procedure (truncates data in the target table in the SQL database).</li>
<li>Runs the stored procedure activity. The stored procedure also sets the data type of each column in the database table.</li>
<li>Runs the copy activity which stages data from a <code>.csv</code> file in azure Datalake blob storage to an empty table in an Azure SQL database.</li>
<li>If the Azure copy activity fails, the error notification logic app API will notify the specified email address of the error.</li>
</ol></li>
</ol>
</section>
<section id="pipeline-configuration-12" class="level3">
<h3 class="anchored" data-anchor-id="pipeline-configuration-12">Pipeline Configuration</h3>
<div class="sourceCode" id="cb15"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb15-1"><a href="#cb15-1"></a><span class="fu">{</span></span>
<span id="cb15-2"><a href="#cb15-2"></a>  <span class="dt">"pipeline"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb15-3"><a href="#cb15-3"></a>    <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"multiple_tables_staging_sql_database"</span><span class="fu">,</span></span>
<span id="cb15-4"><a href="#cb15-4"></a>    <span class="dt">"folder"</span><span class="fu">:</span> <span class="st">"templates/staging/multiple_tables_sql_database"</span><span class="fu">,</span></span>
<span id="cb15-5"><a href="#cb15-5"></a>    <span class="dt">"adl_file_system"</span><span class="fu">:</span> <span class="st">"file_system"</span><span class="fu">,</span></span>
<span id="cb15-6"><a href="#cb15-6"></a>    <span class="dt">"staging"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb15-7"><a href="#cb15-7"></a>          <span class="fu">{</span></span>
<span id="cb15-8"><a href="#cb15-8"></a>            <span class="dt">"stored_procedure"</span><span class="fu">:</span><span class="st">"[dbo].[sql_stored_procedure_table_1]"</span><span class="fu">,</span></span>
<span id="cb15-9"><a href="#cb15-9"></a>            <span class="dt">"source_path"</span><span class="fu">:</span><span class="st">"proc/projects/path/to/processed/data/"</span><span class="fu">,</span></span>
<span id="cb15-10"><a href="#cb15-10"></a>            <span class="dt">"source_file"</span><span class="fu">:</span><span class="st">"table_1.csv"</span><span class="fu">,</span></span>
<span id="cb15-11"><a href="#cb15-11"></a>            <span class="dt">"sink_table"</span><span class="fu">:</span><span class="st">"sql_table_1"</span></span>
<span id="cb15-12"><a href="#cb15-12"></a>          <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb15-13"><a href="#cb15-13"></a>          <span class="fu">{</span></span>
<span id="cb15-14"><a href="#cb15-14"></a>            <span class="dt">"stored_procedure"</span><span class="fu">:</span><span class="st">"[dbo].[sql_stored_procedure_table_2]"</span><span class="fu">,</span></span>
<span id="cb15-15"><a href="#cb15-15"></a>            <span class="dt">"source_path"</span><span class="fu">:</span><span class="st">"proc/projects/path/to/processed/data2/"</span><span class="fu">,</span></span>
<span id="cb15-16"><a href="#cb15-16"></a>            <span class="dt">"source_file"</span><span class="fu">:</span><span class="st">"table_2.csv"</span><span class="fu">,</span></span>
<span id="cb15-17"><a href="#cb15-17"></a>            <span class="dt">"sink_table"</span><span class="fu">:</span><span class="st">"sql_table_2"</span></span>
<span id="cb15-18"><a href="#cb15-18"></a>          <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb15-19"><a href="#cb15-19"></a>          <span class="fu">{</span></span>
<span id="cb15-20"><a href="#cb15-20"></a>            <span class="dt">"stored_procedure"</span><span class="fu">:</span><span class="st">"[dbo].[sql_stored_procedure_table_3]"</span><span class="fu">,</span></span>
<span id="cb15-21"><a href="#cb15-21"></a>            <span class="dt">"source_path"</span><span class="fu">:</span><span class="st">"proc/projects/path/to/processed/data3/"</span><span class="fu">,</span></span>
<span id="cb15-22"><a href="#cb15-22"></a>            <span class="dt">"source_file"</span><span class="fu">:</span><span class="st">"table_3.csv"</span><span class="fu">,</span></span>
<span id="cb15-23"><a href="#cb15-23"></a>            <span class="dt">"sink_table"</span><span class="fu">:</span><span class="st">"sql_table_3"</span></span>
<span id="cb15-24"><a href="#cb15-24"></a>          <span class="fu">}</span></span>
<span id="cb15-25"><a href="#cb15-25"></a>      <span class="ot">]</span></span>
<span id="cb15-26"><a href="#cb15-26"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="data-factory-configuration-12" class="level3">
<h3 class="anchored" data-anchor-id="data-factory-configuration-12">Data Factory Configuration</h3>
<p>Download the Azure Data Factory <code>.json</code> configuration file to use this template in your own data pipelines.</p>
<p><a href="https://raw.githubusercontent.com/nhsx/au-data-engineering/main/config-files/adf-templates/multiple-tables-sql-database-staging.json">multiple-tables-sql-database-staging.json</a></p>


</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><div>MIT</div></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{shenton2021,
  author = {Craig Shenton},
  title = {Azure {Data} {Factory} {Templates}},
  date = {2021-09-09},
  url = {https://craig-shenton.github.io/craigrshenton/azure-data-factory-templates.html},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-shenton2021" class="csl-entry quarto-appendix-citeas" role="doc-biblioentry">
Craig Shenton. 2021. <span>“Azure Data Factory Templates.”</span>
September 9, 2021. <a href="https://craig-shenton.github.io/craigrshenton/azure-data-factory-templates.html">https://craig-shenton.github.io/craigrshenton/azure-data-factory-templates.html</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>